<!DOCTYPE html>
<html>
  <head>
    <title>MeMO</title>
	
    <script type="text/javascript" src="paint.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8" src="Canvas2ImagePlugin.js"></script>
	<script>
        var imgDataUrl;
	var start = function() {
    screen.orientation.lock('portrait');
      
    }
    var canvas,ctx;
    var mouseX,mouseY,mouseDown=0;
    var touchX,touchY;
    var lastX,lastY=-1;
	var tmp;
    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
   
    document.addEventListener("deviceready",onDeviceReady,false);

    
    function onDeviceReady() {
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
	
    }

    
    function onPhotoDataSuccess(imageData) {
      
	 
   var c = document.getElementById("can_model");
   var ctx = c.getContext("2d");
   var img = new Image();
 		 img.onload= drawImageScaled.bind(null, img, ctx);
		 img.src = "data:image/jpeg;base64," + imageData;
  
}
function drawImageScaled(img, ctx) {
   var canvas = ctx.canvas ;
   canvas.height = window.innerHeight-40;
	canvas.width = window.innerWidth;
   var hRatio = canvas.width  / img.width    ;
   var vRatio =  canvas.height / img.height  ;
   var ratio  = Math.min ( hRatio, vRatio );
   var centerShift_x = ( canvas.width - img.width*ratio ) / 2;
   var centerShift_y = ( canvas.height - img.height*ratio ) / 2;  
   ctx.clearRect(0,0,canvas.width, canvas.height);
   ctx.drawImage(img, 0,0, img.width, img.height,centerShift_x,centerShift_y,img.width*ratio, img.height*ratio);
   tmp = ctx.getImageData(0,0,canvas.width, canvas.height);
}

    function onPhotoURISuccess(imageURI) {
	    var c = document.getElementById("can_me");
	    var ctx = c.getContext('2d');
	    var img = new Image();
		img.onload= drawImageScaled.bind(null, img, ctx);
		img.src = imageURI;
   }
    function capturePhoto() {
      
      navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50, destinationType: destinationType.DATA_URL });
    }

    function getPhoto(source) {
      
      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50, destinationType: destinationType.FILE_URI, sourceType: source });
    }

    // Called if something bad happens.
    //
    function onFail(message) {
      alert('Failed because: ' + message);
    }

    // Clear the canvas context using the canvas width and height
    function clearCanvas() {

	var c=document.getElementById("theCanvas");
	var ctx=c.getContext("2d");

	//ctx.clearRect(20,20,100,50);
	  
       ctx.clearRect(0, 0, canvas.width, canvas.height);
	   ctx.putImageData(tmp,0,0);

    }

    // Keep track of the mouse button being pressed and draw a dot at current location
	function saveCanvas()
{
    window.canvas2ImagePlugin.saveImageDataToLibrary(
        function(msg){
            console.log(msg);
        },
        function(err){
            console.log(err);
        },
        document.getElementById("theCanvas")  );
}
function showConfirm() {
//window.plugins.socialsharing.share('DigiGraph','From DigiGraph App', null, imgDataUrl);
 canvas = document.getElementById('theCanvas');
 ctx = canvas.getContext('2d');
imgDataUrl = canvas.toDataURL();
var imageObj = new Image();
    imageObj.src = imgDataUrl;

window.plugins.socialsharing.share('DigiGraph Share','Share',imageObj.src,null);
 // ['www/manual.pdf','https://www.google.nl/images/srpr/logo4w.png'],
 // 'http://www.myurl.com');
}
   // navigator.notification.confirm(
     //   ' Share via', // message
       //  onConfirm,            // callback to invoke with index of button pressed
        //'DigiGraph',           // title
        //['Facebook','Instagram','Viber','WhatsApp']         // buttonLabels
   // );


</script>
	<style>
	h1 {
	font: 15pt vivaldi;
	text-align: center;
	color: #e5b7ad;
	padding-top: 1px ;
	text-shadow: 1px 1px 2px #fff; 
	width:100%;
	}
	
 	.canvasStyle
	{
        border: 1px #CCC solid;
		width:100%;
		height:100%;
    }
	.btncss
	{
	background:none;
	border:none;
	padding:0;
	cursor:pinter;
	font: 8pt arial;
	font-family:Oswald, sans-serif; /*Oswald is available from http://www.google.com/webfonts/specimen/Oswald*/
	color: #b32d5f;
	}
	
  </style>
  </head>
  <body onload="start();">
  <header>
  <h1>MeMO</h1>
  </header>

  
  
 
  <section>
<table width="100%" height="5%">
<tr>
<td><button onclick="getPhoto(pictureSource.PHOTOLIBRARY);" class="btncss">Upload Image</button></td>
<td><button onclick="capturePhoto();" class="btncss">Take a Selfie</button></td>
<td><button onclick="signPhoto();" class="btncss">Sign </button></td>
<td><button onclick="saveCanvas();" class="btncss" >Save</td>
<td><button onclick="clearCanvas();" class="btncss" >Clear</td></tr>
<tr><td colspan=5 align="right"><a href="#" onclick="showConfirm(); return false;">Share</a></td></tr>
</table>
  
</section>
<div id="sketchpadapp">
        <canvas id="theCanvas" class="canvasStyle"></canvas>
</div>






    
  </body>
</html>
